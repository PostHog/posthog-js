name: "Check affected packages"
description: "Checks which packages are affected by a change"

inputs:
  branch:
    description: "The branch to compare against"
    required: false
    default: "main"
  package-name:
    description: "The name of the package to check"
    required: true

outputs:
  is-affected:
    description: "Whether the package is affected"
    value: ${{ steps.check-affected.outputs.is-affected }}

runs:
  using: "composite"
  steps:
    - name: Check if package is affected
      id: check-affected
      shell: bash
      run: |
        AFFECTED=$(pnpx turbo run build '--filter=${{ inputs.package-name }}...[origin/${{inputs.branch}}...HEAD]' --dry=json)
        echo $AFFECTED | jq '.tasks'
        IS_AFFECTED=$(echo "$AFFECTED" | jq '.tasks | length > 0')
        echo "is-affected=$IS_AFFECTED" >> $GITHUB_OUTPUT
